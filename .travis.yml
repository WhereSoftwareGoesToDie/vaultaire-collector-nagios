language: haskell

env:
  - UBUNTU_RELEASE=saucy
  - UBUNTU_RELEASE=trusty

before_install:
  - sudo add-apt-repository -y "deb http://archive.ubuntu.com/ubuntu/ ${UBUNTU_RELEASE} main universe"
  - sudo add-apt-repository -y ppa:hvr/ghc
  - sudo apt-get update
  - sudo apt-get install librados-dev
  - sudo apt-get install cabal-install ghc happy
  - sudo apt-get remove libzmq1
  - wget http://download.zeromq.org/zeromq-4.0.4.tar.gz
  - tar -xf zeromq-4.0.4.tar.gz
  - cd zeromq-4.0.4
  - ./configure
  - make
  - sudo make install
  - sudo su -c "echo '/usr/local/lib' > /etc/ld.so.conf.d/local.conf"
  - sudo ldconfig
  - cd ..

install:
  - cabal update
  - mkdir deps
  - cabal sandbox init
  - cd deps
  - git clone https://github.com/anchor/vaultaire
  - git clone https://github.com/anchor/nagios-perfdata
  - cd ..
  - cabal sandbox add-source ./deps/vaultaire
  - cabal sandbox add-source ./deps/nagios-perfdata
  - cabal install --only-dependencies --enable-tests --enable-benchmarks

script:
  - cabal configure
  - cabal build
  - cabal test
  - cabal sdist
